@model book
@{
    
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Editor";
    bookChapterPage[] apage = this.Model.chapters[0].pages;
    bookChapter[] achapter = this.Model.chapters;
    int numberOfChapters = achapter.Length;
    int numberOfPages = apage.Length;
    int index = 1;
    //string isa = apage[0].id;
}
<h3>Book Editor</h3>
<h3>@Html.ActionLink("View Book", "ViewBook", "Book", null, null)</h3>


<div class="chapters" id="chapters">

    <ul>
        <li><a href="#chapters">Chapter1</a></li>
        <li>
            <button id="btnAddChapter" type="button" value="+">+</button></li>
    </ul>
    <!--Pages section-->
    <div class="pages" id="pages">

        <ul>
          @foreach (bookChapterPage page in @Model.chapters[0].pages)
            {
               
         
                <li><a href="#@page.id">@page.id</a>
                </li> 
            }
            <li><button id="btnAddPage" type="button" value="+">+</button></li>
        </ul>
        <!--End Pages section-->

        <!--Frames section-->
        @for (int indexPages = 0; indexPages < @Model.chapters[0].pages.Length; indexPages++)
        {
            <div class="page" id="@Model.chapters[0].pages[indexPages].id">

                <div class="frame" id="frames">
                @foreach (bookChapterPageFrame frame in @Model.chapters[0].pages[indexPages].frames)
                    {
                    
                        <div id="@frame.id" class="droppable">
                            <img id="img@(frame.id)" border="0" width="700" height="120" alt="" src="~/Images/@(frame.bordertype).png" />
                            <div id="listframes">
                                <span>page:@index-</span>

                            </div>
                        </div>
                    } @{ index++; }
                </div>
            </div>
        }
        <!--End frames section-->

    </div>
</div>


<div class="droppable" id="configDialog">
    <div id="accordion">
        <h3>Contents</h3>
        <div class="leftContent">
            
          @Html.Partial("~/Views/Book/ImageList.cshtml")


            <div id="postButtons">
                <input id="editframescontent" name="editcontent" type="button" value="Next >>" />
                <button id="editcontent" name="editcontent" type="button" value="Save">Save</button>
            </div>
        </div>
        <h3>Status</h3>
        <div class="leftContent">
            <p>
                <textarea id="status" style="width: 256px" cols="20" rows="6"></textarea>
            </p>
        </div>
    </div>
</div>

@section scripts
{
    <script>
        var draggableId = "No Draggable";
        var droppableId = "No droppable";
        var startPos;
        var frameDescriptionArray = new Array();
        var paragraphs = $('div#listframes span');
        var dialogOpts = {
            position: [5, 110]
        };

        //var spans = $('div#listframes span');

        $(function () {
            $("#pages").tabs();
            $("#chapters").tabs();
            $("#configDialog").dialog(dialogOpts);
            $("#accordion").accordion();
        });
        function PostArray(url) {
            jQuery.ajax({
                type: 'POST',
                url: url,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(frameDescriptionArray),
                async: false,
                dataType: "json",
                success: function (msg) {
                    $("editframescontent").show();
                    frameDescriptionArray.length = 0;
                }, error: function (msg) {
                    $('#status').text(msg.Text);
                }
            });
            window.location.reload();
        }
        $("#btnAddPage").click(function () {
            frameDescriptionArray.push("chapter1");
            PostArray("AddPage");
        });
        $("#editcontent").click(function () {
            for (var i = 0; i < paragraphs.length; i++) {
                frameDescriptionArray.push($(paragraphs[i]).text());
            }
            PostArray("AddContentToFrame");
        });
        $("#btnAddChapter").click(function () {
            //  var id = this.value;


        }
  );

        $(function () {
            $(".draggable").draggable({
                drag: function (event, ui) {

                    draggableId = $(this).attr("id");
                    $('body').css('cursor', 'wait');
                    $(this).hide();
                }
            }).addClass("ui-state-highlight");

            $(".droppable").droppable({
                drop: function (event, ui) {
               
             
                    var droppableId = $(this).attr("id");
                    $(this).find("span").append("frame:" + droppableId + "-content:" + draggableId);
             
                      $(this).find("img").attr("src", "../Images/" + draggableId + ".png");
                      $("#" + draggableId).css({ position: "relative", top: 0, left: 0 });
                   $("#" + draggableId).show();      
                }
            }).addClass("ui-state-highlight");
        });
    </script>
}
