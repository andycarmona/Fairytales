@model book
@{
    
    Layout = "~/Views/Shared/Editor_Layout.cshtml";
    ViewBag.Title = "Editor";
    bookChapterPage[] apage = this.Model.chapters[0].pages;
    bookChapter[] achapter = this.Model.chapters;
    int numberOfChapters = achapter.Length;
    int numberOfPages= apage.Length;
    int index = 1;
    //string isa = apage[0].id;
}
<h3>Book Editor</h3>
 <h3> @Html.ActionLink("View Book", "ViewBook", "Book", null, null)</h3>


<div class="chapters" id="chapters">
    
    <ul>
        <li><a href="#chapters">Chapter1</a></li>
        <li><button id="btnAddChapter" type="button" value="+">+</button></li>
    </ul>
    <!--Pages section-->
    <div class="pages" id="pages">
       
        <ul>
            @for (var i = 0; i < numberOfPages;i++ )
            {
         
                <li><a href="#page@(i+1)">page@(i+1)</a>
                </li> 
            }
            <li><button id="btnAddPage" type="button" value="+">+</button></li>
        </ul>
        <!--End Pages section-->

        <!--Frames section-->
        @foreach (var page in @Model.chapters[0].pages)
        {
            <div class="page" id="@page.id">

                <div id="frames">
                    @foreach (bookChapterPageFrame frame in @Model.chapters[0].pages[0].frames)
                    {
                        <div id="@frame.id" class="droppable">
                            <img id="img@(frame.id)" border="0" width="700" height="133" alt="" src="" />
                            <div id="listframes">
                                <span hidden="true">page:@index-</span>
                               
                            </div>
                        </div>
                    } @{ index++; }
                </div>
            </div>
        }
        <!--End frames section-->
     
    </div>
</div>
   

<div id="configDialog">
    <div id="myDialogText"></div>
    <div style="width: 235px;right: 0;position: absolute;" class="ui-widget ui-widget-content ui-corner-all">

    <img class="draggable" id="triangle" src="../Images/triangle.png" border="0" width="150" height="133" alt="" />



    <img id="rectangle" alt="" class="draggable" src="../Images/rectangle.png" width="150" height="137" title="MainContent" />
    <div id="postButtons"> <input id="editframescontent" name="editcontent" type="button" value="Edit content in frames" />
        <button id="editcontent" name="editcontent" type="button" value="Save">Save</button> </div>
    <div id="status"></div>

</div>
</div>

@section scripts
{
    <script>
        var draggableId = "No Draggable";
        var droppableId = "No droppable";
        var startPos;
        var frameDescriptionArray = new Array();
        var paragraphs = $('div#listframes span');
        //var spans = $('div#listframes span');

        $(function () {
            $("#pages").tabs();
            $("#chapters").tabs();

        });
        function PostArray(url) {
            jQuery.ajax({
                type: 'POST',
                url: url,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(frameDescriptionArray),
                async: false,
                dataType: "json",
                success: function (msg) {
                    $("editframescontent").show();
                    frameDescriptionArray.length = 0;
                }, error: function (msg) {
                    $('#status').text(msg.Text);
                }
            });
        }
        $("#btnAddPage").click(function () {
            frameDescriptionArray.push("chapter1");
            PostArray("AddPage");
        });
        $("#editcontent").click(function () {
            for (var i = 0; i < paragraphs.length; i++) {
                frameDescriptionArray.push($(paragraphs[i]).text());
            }
            PostArray("AddContentToFrame");
        });
        $("#btnAddChapter").click(function () {
          //  var id = this.value;
           $("#configDialog").dialog();
          
             @{ numberOfPages = numberOfChapters + 1;};
            $("#myDialogText").append(@numberOfChapters);
        }
  );
        
        $(function () {
            $(".draggable").draggable({
                drag: function (event, ui) {
                    draggableId = $(this).attr("id");

                }
            }).addClass("ui-state-highlight");

            $(".droppable").droppable({
                drop: function (event, ui) {

                    var droppableId = $(this).attr("id");
                    $(this).find("span").append("frame:" + droppableId + "-content:" + draggableId);
                    $(this).find("img").attr("src", "../Images/" + draggableId + ".png");


                    $("#" + draggableId).css({ top: 30, left: 20 });
                }
            }).addClass("ui-state-highlight");
        });
    </script>
}
